name: Economic Circuit Breaker

on:
  schedule:
    - cron: '0 * * * *'  # 1æ™‚é–“ã”ã¨ã«å®Ÿè¡Œ
  workflow_dispatch:  # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

permissions:
  issues: write
  actions: write
  contents: read

jobs:
  monitor-cost:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Check billing API (Placeholder)
        id: check-billing
        run: |
          # TODO: å®Ÿéš›ã®Billing APIçµ±åˆ
          # ç¾åœ¨ã¯ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼å®Ÿè£…
          echo "is_over_budget=false" >> $GITHUB_OUTPUT
          echo "current_cost=0" >> $GITHUB_OUTPUT
          echo "budget_limit=100" >> $GITHUB_OUTPUT
          echo "âœ… Cost monitoring: Within budget"

      - name: Declare Economic Emergency if cost exceeds threshold
        if: steps.check-billing.outputs.is_over_budget == 'true'
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # å…¨ã¦ã®é–‹ç™ºç³»ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä¸€æ™‚åœæ­¢
          gh api -X PUT /repos/${{ github.repository }}/actions/workflows/claude-code.yml/disable || true

          # ç·Šæ€¥Issueã‚’èµ·ç¥¨
          gh issue create \
            --title "ğŸ¤–ğŸš¨ Economic Circuit Breaker Triggered" \
            --body "## çµŒæ¸ˆçš„éå¸¸äº‹æ…‹å®£è¨€

**ãƒˆãƒªã‚¬ãƒ¼æ™‚åˆ»:** $(date -u +"%Y-%m-%d %H:%M:%S UTC")
**ç¾åœ¨ã‚³ã‚¹ãƒˆ:** \$$(echo '${{ steps.check-billing.outputs.current_cost }}')
**äºˆç®—ä¸Šé™:** \$$(echo '${{ steps.check-billing.outputs.budget_limit }}')

### ã‚·ã‚¹ãƒ†ãƒ ã®çŠ¶æ…‹

- ğŸ›‘ **é–‹ç™ºç³»ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä¸€æ™‚åœæ­¢ã—ã¾ã—ãŸ**
- ğŸ“Š **ã‚³ã‚¹ãƒˆæ¶ˆè²»ãƒšãƒ¼ã‚¹ãŒäºˆç®—ã®150%ã‚’è¶…ãˆã‚‹ã¨äºˆæ¸¬ã•ã‚Œã¾ã—ãŸ**

### æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

Guardian ã®ä»‹å…¥ã‚’è¦è«‹ã—ã¾ã™ã€‚ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„:

1. ã‚³ã‚¹ãƒˆæ€¥å¢—ã®åŸå› åˆ†æ
2. äºˆç®—èª¿æ•´ã¾ãŸã¯æœ€é©åŒ–ã®åˆ¤æ–­
3. ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å†é–‹æ‰¿èª

### è‡ªå‹•å®Ÿè¡Œã•ã‚ŒãŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³

- [x] claude-code.yml ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ç„¡åŠ¹åŒ–
- [x] Guardian ã¸ã®ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥

---

**AGENTS.md å‚ç…§:** [çµŒæ¸ˆçš„ã‚¬ãƒãƒŠãƒ³ã‚¹ãƒ—ãƒ­ãƒˆã‚³ãƒ«](../AGENTS.md#economic_governance_protocol)
" \
            --label "P0-Critical,human-intervention-required,economic-emergency"

          echo "ğŸš¨ Economic Circuit Breaker activated! Issue created."

      - name: Log monitoring result
        if: steps.check-billing.outputs.is_over_budget == 'false'
        run: |
          echo "âœ… Cost monitoring completed successfully"
          echo "Current cost: ${{ steps.check-billing.outputs.current_cost }}"
          echo "Budget limit: ${{ steps.check-billing.outputs.budget_limit }}"
